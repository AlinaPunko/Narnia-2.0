{"version":3,"sources":["webpack:///./src/components/booksList/BooksList/booksList.jsx"],"names":["BooksList","props","context","bookPerPage","state","page","isLoading","renderedBooks","handleScroll","bind","loadFavoriteBooks","loadBooks","window","addEventListener","removeEventListener","localStorageHelper","getId","undefined","getRole","favoritesService","getItems","favoriteBooks","setFavoriteBooks","bookService","getAll","result","addBooks","setState","lastBook","document","querySelector","lastBookOffset","offsetTop","clientHeight","pageOffset","pageYOffset","innerHeight","loadMore","displayedBooks","books","slice","map","book","id","renderBooks","preloader","React","PureComponent","PropTypes","array","isRequired","func","UserContext","connect"],"mappings":"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","file":"main.620f27b0563795eb80f9.hot-update.js","sourcesContent":["import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { connect } from 'react-redux';\r\n\r\nimport { UserContext } from 'store/context/userContext';\r\nimport favoritesService from 'services/favoritesService';\r\nimport bookService from 'services/bookService';\r\nimport BooksListItem from 'components/booksList/BooksListItem/booksListItem';\r\nimport Icon from 'components/common/Icon/icon';\r\nimport localStorageHelper from 'helpers/localStorageHelper';\r\n\r\nimport preloader from 'styles/icons/preloader.svg';\r\nimport './booksList.scss';\r\n\r\nclass BooksList extends React.PureComponent {\r\n    static propTypes = {\r\n        books: PropTypes.array.isRequired,\r\n        addBooks: PropTypes.func.isRequired\r\n    };\r\n\r\n    static contextType = UserContext;\r\n\r\n    constructor(props, context) {\r\n        super(props, context);\r\n\r\n        this.bookPerPage = 12;\r\n        this.state = {\r\n            page: 1,\r\n            isLoading: true,\r\n            renderedBooks: this.bookPerPage\r\n        };\r\n        this.handleScroll = this.handleScroll.bind(this);\r\n        this.loadFavoriteBooks = this.loadFavoriteBooks.bind(this);\r\n    }\r\n\r\n    async componentDidMount() {\r\n        await this.loadFavoriteBooks();\r\n        this.loadBooks();\r\n        window.addEventListener('scroll', this.handleScroll);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        window.removeEventListener('scroll', this.handleScroll);\r\n    }\r\n\r\n    async loadFavoriteBooks() {\r\n        if (localStorageHelper.getId() === '' || localStorageHelper.getId() === undefined || localStorageHelper.getRole) {\r\n            return;\r\n        }\r\n\r\n        const favoriteBooks = await favoritesService.getItems(localStorageHelper.getId());\r\n        this.context.setFavoriteBooks(favoriteBooks);\r\n    }\r\n\r\n    async loadBooks() {\r\n        const result = await bookService.getAll();\r\n        this.props.addBooks(result);\r\n        this.setState({ isLoading: false });\r\n    }\r\n\r\n    handleScroll() {\r\n        const lastBook = document.querySelector('.books-list > div:last-child');\r\n        const lastBookOffset = lastBook.offsetTop + lastBook.clientHeight;\r\n        const pageOffset = window.pageYOffset + window.innerHeight;\r\n        if (pageOffset > lastBookOffset) {\r\n            this.loadMore();\r\n        }\r\n\r\n        this.setState({ isLoading: false });\r\n    }\r\n\r\n    loadMore() {\r\n        const { page, renderedBooks } = this.state;\r\n        this.setState({\r\n            isLoading: true,\r\n            page: page + 1,\r\n            renderedBooks: renderedBooks + this.bookPerPage\r\n        });\r\n    }\r\n\r\n    renderBooks() {\r\n        const displayedBooks = this.props.books.slice(0, this.state.renderedBooks);\r\n        return displayedBooks.map((book) => (<BooksListItem book={book} key={book.id} />));\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <>\r\n                <div className=\"books-list\">\r\n                    {\r\n                        this.renderBooks()\r\n                    }\r\n                </div>\r\n                {this.state.isLoading && (\r\n                    <div className=\"books-list__preloader\">\r\n                        <Icon iconClassName=\"books-list__preloader-icon\" icon={preloader} />\r\n                    </div>\r\n                )}\r\n            </>\r\n        );\r\n    }\r\n}\r\n\r\nexport default connect()(BooksList);\r\n"],"sourceRoot":""}